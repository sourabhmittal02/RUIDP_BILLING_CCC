
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";

}

<!-- ########## START: MAIN PANEL ########## -->

    <div class="pd-10">
        <h4 class="tx-gray-800 mg-b-5">Dashboard</h4>
        <p class="mg-b-0">
            Welcome back,  @if (@Session["User_Name"] != null)
            {@Session["User_Name"]}!
        </p>
    </div><!-- d-flex -->

    <div class="br-pagebody mg-t-3 pd-x-5">
        <div class="row row-sm">
            <div class="col-sm-6 col-xl-3">
                <div class="bg-teal rounded overflow-hidden">
                    <div class="pd-25 d-flex align-items-center">
                        <i class="ion ion-earth tx-60 lh-0 tx-white op-7"></i>
                        <div class="mg-l-20">
                            <p class="tx-10 tx-spacing-1 tx-mont tx-medium tx-uppercase tx-white-8 mg-b-10">@DateTime.Now.AddMonths(-1).ToString("yyyy, MMM")</p>
                            <p class="tx-24 tx-white tx-lato tx-bold mg-b-2 lh-1"><label id="pmTc">0</label></p>
                            <span class="tx-11 tx-roboto tx-white-6">Total Complaints</span>
                        </div>
                    </div>
                </div>
            </div><!-- col-3 -->
            <div class="col-sm-6 col-xl-3 mg-t-20 mg-sm-t-0">
                <div class="bg-danger rounded overflow-hidden">
                    <div class="pd-25 d-flex align-items-center">
                        <i class="ion ion-bag tx-60 lh-0 tx-white op-7"></i>
                        <div class="mg-l-20">
                            <p class="tx-10 tx-spacing-1 tx-mont tx-medium tx-uppercase tx-white-8 mg-b-10">@DateTime.Now.AddMonths(-1).ToString("yyyy, MMM")</p>
                            <p class="tx-24 tx-white tx-lato tx-bold mg-b-2 lh-1"><label id="pmRc">0</label></p>
                            <span class="tx-11 tx-roboto tx-white-6">Resolved Complaints</span>
                        </div>
                    </div>
                </div>
            </div><!-- col-3 -->
            <div class="col-sm-6 col-xl-3 mg-t-20 mg-xl-t-0">
                <div class="bg-primary rounded overflow-hidden">
                    <div class="pd-25 d-flex align-items-center">
                        <i class="ion ion-monitor tx-60 lh-0 tx-white op-7"></i>
                        <div class="mg-l-20">
                            <p class="tx-10 tx-spacing-1 tx-mont tx-medium tx-uppercase tx-white-8 mg-b-10">@DateTime.Now.ToString("yyyy, MMM")</p>
                            <p class="tx-24 tx-white tx-lato tx-bold mg-b-2 lh-1"><label id="cmTc">0</label></p>
                            <span class="tx-11 tx-roboto tx-white-6">Total Complaints</span>
                        </div>
                    </div>
                </div>
            </div><!-- col-3 -->
            <div class="col-sm-6 col-xl-3 mg-t-20 mg-xl-t-0">
                <div class="bg-br-primary rounded overflow-hidden">
                    <div class="pd-25 d-flex align-items-center">
                        <i class="ion ion-clock tx-60 lh-0 tx-white op-7"></i>
                        <div class="mg-l-20">
                            <p class="tx-10 tx-spacing-1 tx-mont tx-medium tx-uppercase tx-white-8 mg-b-10">@DateTime.Now.ToString("yyyy, MMM")</p>
                            <p class="tx-24 tx-white tx-lato tx-bold mg-b-2 lh-1"><label id="cmRc">0</label></p>
                            <span class="tx-11 tx-roboto tx-white-6">Resolved Complaints</span>
                        </div>
                    </div>
                </div>
            </div><!-- col-3 -->
        </div><!-- row -->

        <div class="row row-sm mg-t-5">
            <div class="col-12">

                <div class="card pd-0 bd-0 shadow-base">
                    <div class="pd-x-30 pd-t-30 pd-b-15">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h6 class="tx-13 tx-uppercase tx-inverse tx-semibold tx-spacing-1">Complaints summary</h6>
                                <p class="mg-b-0">Complaints summary of Complaint Registered and resolved</p>
                            </div>
                            <div class="tx-13">
                                <p class="mg-b-0"><span class="square-8 rounded-circle bg-purple mg-r-10"></span> Registered Complaint</p>
                                <p class="mg-b-0"><span class="square-8 rounded-circle bg-pink mg-r-10"></span> Complaint Resolved</p>
                            </div>
                        </div><!-- d-flex -->
                    </div>
                    <div class="pd-x-15 pd-b-15">
                        <div id="ch1" class="br-chartist br-chartist ht-100 ht-sm-200"></div>
                    </div>
                </div><!-- card -->
            </div>
        </div><!-- br-pagebody -->

        <div class="row row-sm mg-t-5">
            <div class="col-8">
                <div class="card bd-0 shadow-base pd-30">
                    <h6 class="tx-gray-800 tx-uppercase tx-bold tx-14 mg-t-2 mg-b-10">Complaint Summary</h6>
                    <p class="mg-b-1 mg-lg-b-5">Complaint summary showing Registered and Resolved Complaints</p>
                    <div class="table-wrapper">
                        <table id="datatable2" class="table table-valign-middle mg-b-0">
                            <thead>
                                <tr>
                                    <th>Circle Name</th>
                                    <th class="d-none d-xl-table-cell">Total Complaints</th>
                                    <th class="d-none d-xl-table-cell">Pending Complaints</th>
                                    <th>Reopen</th>
                                    <th class="d-none d-md-table-cell">Resolved</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div><!-- table-wrapper -->
                </div><!-- card -->
            </div>
            <div class="col-4">

                <div class="card pd-0 bd-0 shadow-base pd-30">
                    <h6 class="tx-gray-800 tx-uppercase tx-bold tx-14 mg-t-1 mg-b-1">Current Month Complaints</h6>
                    <div class="bd pd-5">
                        <div id="chartPie1" class="br-chartist ht-100 ht-md-250"></div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="br-footer">
            <div class="footer-left">
                <div class="mg-b-2">Copyright &copy; 2017. Sandha & Company. All Rights Reserved.</div>
                <div>Attentively and carefully made by Sandha.</div>
            </div>
            <div class="footer-right d-flex align-items-center">
                <span class="tx-uppercase mg-r-10">Share:</span>
                <a target="_blank" class="pd-x-5" href="https://www.facebook.com/sharer/sharer.php?u=http%3A//themepixels.me/bracket/intro"><i class="fa fa-facebook tx-20"></i></a>
                <a target="_blank" class="pd-x-5" href="https://twitter.com/home?status=Bracket,%20your%20best%20choice%20for%20premium%20quality%20admin%20template%20from%20Bootstrap.%20Get%20it%20now%20at%20http%3A//themepixels.me/bracket/intro"><i class="fa fa-twitter tx-20"></i></a>
            </div>
        </footer>

    </div><!-- br-mainpanel -->
    <!-- ########## END: MAIN PANEL ########## -->
    <div id="loadPopUp">

    </div>
<
<script>
    var TotalComplaints = 0;
    var ResolvedComplaints=0;
    var PendingComplaints = 0;
    $(document).ready(function () {
        loadpage();
    });

    function bindPieChart() {
        PendingComplaints = parseInt(TotalComplaints) - parseInt(ResolvedComplaints);
        var dataComplaints = {
            series: [TotalComplaints, ResolvedComplaints, PendingComplaints]
        }
        var pie1 = new Chartist.Pie('#chartPie1',
            dataComplaints
            ,{
                donut: true,
                showLabel: true
            }
        );
    }
    function showLoginmsg() {
            var message = '@TempData["loginmsg"]';
            var title = "Login Success";
            var type = "success";
            toastr[type](message, title, {
                positionClass: "toast-top-right",
                closeButton: "checked",
                progressBar: "checked",
                newestOnTop: "checked",
                rtl: $("body").attr("dir") === "rtl" || $("html").attr("dir") === "rtl",
                timeOut: 5000
            });
    }
    function loadpage() {
        var Pc = 0;
        var arrM = [];
        var arrTC = [];
        var arrTR = [];
        $.ajax({
            type: "GET",
            url: '/Dashboard/ComplaintSourceJson',
            contentType: "application/json; charset=utf-8",
            datatype: JSON,
            async: true,
            success: function (result) {
                //Tiles
                $('#cmTc').text(result.CurrentMonthTotalComplaint);
                $('#cmRc').text(result.CurrentMonthResolvedComplaint);
                $('#pmTc').text(result.PreviousMonthTotalComplaint);
                $('#pmRc').text(result.PreviousMonthResolvedComplaint);

                //Grid
                $('#datatable2').DataTable({
                    data: result.CircleWiseComplaintSummaryData,
                    columns: [
                        { 'data': 'CircleName' },
                        { 'data': 'TotalComplaint' },
                        { 'data': 'TotalPendingComplaints' },
                        { 'data': 'TotalReopenComplaint' },
                        { 'data': 'TotalResolvedComplaints' },
                    ],

                    bLengthChange: false,
                    searching: false,
                    responsive: true
                });


                // Line chart
                $.each(result.ComplaintSummaries, function (index, value) {
                    arrM.push(value.Month);
                    arrTC.push(value.TotalComplaint);
                    arrTR.push(value.ResolveComplaint);
                });

                var ch1 = new Chartist.Line('#ch1', {
                    labels: arrM,
                    series: [arrTR, arrTC]
                }, {
                    high: 80000,
                    low: 0,
                    axisY: {
                        onlyInteger: true
                    },
                    showArea: true,
                    fullWidth: true,
                    chartPadding: {
                        bottom: 0,
                        left: 0
                    }
                });

                // Pie chart and Data
                Pc = result.CurrentMonthTotalComplaint - result.CurrentMonthResolvedComplaint;


               TotalComplaints=result.CurrentMonthTotalComplaint;
               ResolvedComplaints=result.CurrentMonthResolvedComplaint;
               PendingComplaints = Pc
               bindPieChart();
            },
            error: function (data) { }
        });
    }

</script>

